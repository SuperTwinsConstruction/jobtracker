<div style="max-width: 500px; margin: auto; font-family: sans-serif;">
  <h3>Track Your Project</h3>
  <label for="invoiceInput">Enter Your Tracker ID:</label><br>
  <input
    type="text"
    id="invoiceInput"
    placeholder="e.g. 10022"
    style="padding: 8px; width: 100%; margin-top: 8px;"
  />
  <button
    onclick="getInvoice()"
    style="margin-top: 10px; padding: 8px 16px;"
  >
    View My Job
  </button>

  <div
    id="output"
    style="margin-top: 20px; border: 1px solid #ccc; padding: 12px; border-radius: 6px;"
  ></div>
</div>

<script>
  async function getInvoice() {
    const invoice = document.getElementById("invoiceInput").value.trim();
    const outputDiv = document.getElementById("output");

    if (!invoice) {
      outputDiv.innerHTML = "<p style='color:red;'>Please enter your Tracker ID.</p>";
      return;
    }

    outputDiv.innerHTML = "Loading...";

    const url = `https://script.google.com/macros/s/AKfycbwKldLZMicVFwKVVqtfg3PEZgJGFu-B5qdlVq16sHBIgu6KE3tC3uait0O8miFpmQ_p-g/exec?invoice=${encodeURIComponent(invoice)}`;

    try {
      const res = await fetch(url);
      const text = await res.text();

      // Check for possible error messages returned by your script
      if (
        text === "Invoice not found" ||
        text === "Missing invoice parameter" ||
        text === "Tracker ID column not found"
      ) {
        outputDiv.innerHTML = `<p style="color:red;">${text}</p>`;
        return;
      }

      const data = JSON.parse(text);

      outputDiv.innerHTML = `
        <h4>Project Details</h4>
        <p><strong>Name:</strong> ${data["Name"] || "N/A"}</p>
        <p><strong>Date:</strong> ${data["Date"] || "N/A"}</p>
        <p><strong>Phone:</strong> ${data["Phone"] || "N/A"}</p>
        <p><strong>Email:</strong> ${data["Email"] || "N/A"}</p>
        <p><strong>Service:</strong> ${data["Service"] || "N/A"}</p>
        <p><strong>Cost:</strong> ${data["$$$"] || "N/A"}</p>
        <p><strong>Notes:</strong> ${data["Notes"] || "N/A"}</p>
        <p><strong>Contract Date:</strong> ${data["Contract Date"] || "N/A"}</p>
        <p><strong>Start Date:</strong> ${data["Start Date"] || "N/A"}</p>
        <p><strong>Projected Completion Date:</strong> ${data["Projected Completion Date"] || "N/A"}</p>
        <p><strong>Status:</strong> ${data["Status"] || "N/A"}</p>
        <p><strong>Tracker ID:</strong> ${data["Tracker ID"] || "N/A"}</p>
      `;
    } catch (err) {
      outputDiv.innerHTML =
        "<p style='color:red;'>Error retrieving data. Please try again later.</p>";
      console.error("Fetch error:", err);
    }
  }
</script>
